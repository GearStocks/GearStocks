version: 2.1
jobs:
  dev:
    docker:
      - image: ubuntu:latest
    steps:
      - checkout
      - run: apt -y install curl
      - run: set -x; curl -L https://github.com/docker/compose/releases/download/1.25.3/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose; chmod +x /usr/local/bin/docker-compose
      - run: echo Test the pull request on dev.
      - run: echo MONGO_INITDB_ROOT_USERNAME=mongoadmin\nMONGO_INITDB_ROOT_PASSWORD=mongoadmin > database/secrets.env
      - run: docker-compose up front api_builder
      - run: echo Front and Back successfully build.

  master:
    docker:
      - image: ubuntu:latest
    steps:
      - checkout
      - run: apt -y install curl
      - run: set -x; curl -L https://github.com/docker/compose/releases/download/1.25.3/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose; chmod +x /usr/local/bin/docker-compose
      - run: echo Test the pull request on master.
      - run: echo MONGO_INITDB_ROOT_USERNAME=mongoadmin\nMONGO_INITDB_ROOT_PASSWORD=mongoadmin > database/secrets.env
      - run: docker-compose up front api_builder
      - run: echo Front and Back successfully build.

      
workflows:
  version: 2
  workflow:
    jobs:
      - dev:
        filters:
          branches:
            only:
              - dev
      - master:
        filters:
          branches:
            only:
              - master